üöÄ Running All Tests...
======================
time="2026-01-23T14:24:20-05:00" level=warning msg="/Users/harold/code/agentic_ai_rpg_demo/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
‚è≥ Waiting for backend to be ready...
‚úÖ Backend is ready!

üìã Test Summary:
================
1Ô∏è‚É£  Unit Tests (All unit test files):
time="2026-01-23T14:24:20-05:00" level=warning msg="/Users/harold/code/agentic_ai_rpg_demo/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
onnxruntime cpuid_info warning: Unknown CPU vendor. cpuinfo_vendor value: 0
test_character_has_game_sessions_relationship (test_database_models_unit.TestDatabaseModelRelationships.test_character_has_game_sessions_relationship)
Test Character model has game_sessions relationship defined. ... ok
test_discovery_has_game_session_relationship (test_database_models_unit.TestDatabaseModelRelationships.test_discovery_has_game_session_relationship)
Test Discovery has game_session relationship. ... ok
test_game_session_has_character_relationship (test_database_models_unit.TestDatabaseModelRelationships.test_game_session_has_character_relationship)
Test GameSession has character relationship. ... ok
test_character_model_creation (test_database_models_unit.TestDatabaseModels.test_character_model_creation)
Test Character model can be created with required fields. ... ok
test_character_repr (test_database_models_unit.TestDatabaseModels.test_character_repr)
Test Character __repr__ method. ... ok
test_discovery_model_creation (test_database_models_unit.TestDatabaseModels.test_discovery_model_creation)
Test Discovery model can be created. ... ok
test_discovery_types (test_database_models_unit.TestDatabaseModels.test_discovery_types)
Test Discovery model supports different discovery types. ... ok
test_game_session_default_values (test_database_models_unit.TestDatabaseModels.test_game_session_default_values)
Test GameSession default values. ... ok
test_game_session_model_creation (test_database_models_unit.TestDatabaseModels.test_game_session_model_creation)
Test GameSession model can be created with required fields. ... ok
test_narrative_history_model_creation (test_database_models_unit.TestDatabaseModels.test_narrative_history_model_creation)
Test NarrativeHistory model can be created. ... ok
test_narrative_history_optional_fields (test_database_models_unit.TestDatabaseModels.test_narrative_history_optional_fields)
Test NarrativeHistory with minimal required fields. ... ok
test_create_character_operation (test_database_models_unit.TestDatabaseOperations.test_create_character_operation)
Test creating a character in the database. ... ok
test_create_game_session_with_snapshot (test_database_models_unit.TestDatabaseOperations.test_create_game_session_with_snapshot)
Test creating game session with state snapshot. ... ok
test_rollback_on_error (test_database_models_unit.TestDatabaseOperations.test_rollback_on_error)
Test that session rollback is called on error. ... ok
test_parse_ability_dash (test_mechanics_unit.TestSimpleAbilitySystem.test_parse_ability_dash)
Test parsing dash ability. ... ok
test_parse_ability_illuminate (test_mechanics_unit.TestSimpleAbilitySystem.test_parse_ability_illuminate)
Test parsing illuminate ability. ... ok
test_parse_ability_invalid (test_mechanics_unit.TestSimpleAbilitySystem.test_parse_ability_invalid)
Test parsing invalid ability returns not-is_ability. ... ok
test_parse_ability_sneak (test_mechanics_unit.TestSimpleAbilitySystem.test_parse_ability_sneak)
Test parsing sneak ability. ... ok
test_use_dash_ability (test_mechanics_unit.TestSimpleAbilitySystem.test_use_dash_ability)
Test using dash ability. ... ok
test_use_illuminate_ability (test_mechanics_unit.TestSimpleAbilitySystem.test_use_illuminate_ability)
Test using illuminate ability. ... ok
test_use_sneak_ability (test_mechanics_unit.TestSimpleAbilitySystem.test_use_sneak_ability)
Test using sneak ability. ... ok
test_check_defeat_health_negative (test_mechanics_unit.TestVictoryDefeatConditions.test_check_defeat_health_negative)
Test defeat when health is negative. ... ok
test_check_defeat_health_zero (test_mechanics_unit.TestVictoryDefeatConditions.test_check_defeat_health_zero)
Test defeat when health reaches zero. ... ok
test_check_victory_success (test_mechanics_unit.TestVictoryDefeatConditions.test_check_victory_success)
Test successful victory condition. ... ok
test_check_victory_with_crystal_wrong_location (test_mechanics_unit.TestVictoryDefeatConditions.test_check_victory_with_crystal_wrong_location)
Test victory check with crystal but wrong location. ... ok
test_check_victory_without_crystal (test_mechanics_unit.TestVictoryDefeatConditions.test_check_victory_without_crystal)
Test victory check without crystal. ... ok
test_get_defeat_narrative_health (test_mechanics_unit.TestVictoryDefeatConditions.test_get_defeat_narrative_health)
Test defeat narrative for health depletion. ... ok
test_get_defeat_narrative_none (test_mechanics_unit.TestVictoryDefeatConditions.test_get_defeat_narrative_none)
Test defeat narrative with no reason. ... ok
test_get_victory_narrative (test_mechanics_unit.TestVictoryDefeatConditions.test_get_victory_narrative)
Test victory narrative generation. ... ok
test_initialize_game_mechanics (test_mechanics_unit.TestVictoryDefeatConditions.test_initialize_game_mechanics)
Test game mechanics initialization. ... ok
test_no_defeat_healthy (test_mechanics_unit.TestVictoryDefeatConditions.test_no_defeat_healthy)
Test no defeat when healthy. ... ok
test_update_game_status_defeat (test_mechanics_unit.TestVictoryDefeatConditions.test_update_game_status_defeat)
Test game status update on defeat. ... ok
test_update_game_status_in_progress (test_mechanics_unit.TestVictoryDefeatConditions.test_update_game_status_in_progress)
Test game status remains in progress. ... ok
test_update_game_status_victory (test_mechanics_unit.TestVictoryDefeatConditions.test_update_game_status_victory)
Test game status update on victory. ... ok
test_examine_allows_matching_class_hints (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_examine_allows_matching_class_hints)
Test that examine allows hints for the correct class. ... ok
test_examine_filters_wrong_class_hints_rogue (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_examine_filters_wrong_class_hints_rogue)
Test that examine filters out wizard/warrior hints for rogue. ... ok
test_examine_filters_wrong_class_hints_warrior (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_examine_filters_wrong_class_hints_warrior)
Test that examine filters out wizard/rogue hints for warrior. ... ok
test_examine_filters_wrong_class_hints_wizard (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_examine_filters_wrong_class_hints_wizard)
Test that examine filters out rogue/warrior hints for wizard. ... ok
test_examine_without_class_shows_all (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_examine_without_class_shows_all)
Test that examine without character_class doesn't filter class hints. ... ok
test_get_room_description_applies_filtering (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_get_room_description_applies_filtering)
Test that get_room_description calls item filtering with inventory. ... ok
test_get_room_description_with_empty_inventory (test_room_descriptor_unit.TestRoomDescriptorIntegration.test_get_room_description_with_empty_inventory)
Test room description when inventory is empty. ... ok
test_filter_case_insensitive_matching (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_case_insensitive_matching)
Test that item matching is case-insensitive. ... ok
test_filter_empty_description (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_empty_description)
Test with empty description. ... ok
test_filter_empty_inventory (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_empty_inventory)
Test with explicitly empty inventory. ... ok
test_filter_handles_underscores_in_item_names (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_handles_underscores_in_item_names)
Test that item_ids with underscores match descriptions with spaces. ... ok
test_filter_item_mentioned_multiple_times (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_item_mentioned_multiple_times)
Test filtering when item is mentioned in multiple sentences. ... ok
test_filter_multiple_items (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_multiple_items)
Test filtering multiple items from description. ... ok
test_filter_no_items_picked_up (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_no_items_picked_up)
Test that description is unchanged when no items are picked up. ... ok
test_filter_preserves_other_content (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_preserves_other_content)
Test that filtering doesn't affect unrelated content. ... ok
test_filter_single_item_with_hangs (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_single_item_with_hangs)
Test filtering a sentence with 'hangs' indicator. ... ok
test_filter_single_item_with_lies (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_single_item_with_lies)
Test filtering a sentence with 'lies' indicator. ... ok
test_filter_single_item_with_rests (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_single_item_with_rests)
Test filtering a sentence with 'rests' indicator. ... ok
test_filter_with_coiled_indicator (test_room_descriptor_unit.TestRoomDescriptorItemFiltering.test_filter_with_coiled_indicator)
Test filtering with 'coiled' indicator word. ... ok
test_character_classes_endpoint (test_sessions_unit.TestSessionsUnit.test_character_classes_endpoint)
Test character classes endpoint returns proper data. ... INFO:httpx:HTTP Request: GET http://test/character/classes "HTTP/1.1 200 OK"
ok
test_get_game_state_not_found (test_sessions_unit.TestSessionsUnit.test_get_game_state_not_found)
Test error handling when session is not found. ... INFO:httpx:HTTP Request: GET http://test/game/nonexistent-game/state "HTTP/1.1 200 OK"
ok
test_get_game_state_returns_session (test_sessions_unit.TestSessionsUnit.test_get_game_state_returns_session)
Test that get_game_state returns the session from Redis. ... INFO:httpx:HTTP Request: GET http://test/game/test-game-123/state "HTTP/1.1 200 OK"
ok
test_process_command_increments_turn_and_saves (test_sessions_unit.TestSessionsUnit.test_process_command_increments_turn_and_saves)
Test that processing commands increments turn count and saves session. ... INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:chromadb.telemetry.product.posthog:Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
ERROR:chromadb.telemetry.product.posthog:Failed to send telemetry event ClientStartEvent: capture() takes 1 positional argument but 3 were given
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
ERROR:chromadb.telemetry.product.posthog:Failed to send telemetry event CollectionQueryEvent: capture() takes 1 positional argument but 3 were given
INFO:httpx:HTTP Request: POST http://test/game/test-game-123/command "HTTP/1.1 200 OK"
WARNING:asyncio:Executing <Task finished name='Task-67' coro=<TestSessionsUnit.test_process_command_increments_turn_and_saves() done, defined at /usr/local/lib/python3.11/unittest/mock.py:1390> result=None created at /usr/local/lib/python3.11/asyncio/runners.py:100> took 0.406 seconds
ok
test_process_command_session_not_found (test_sessions_unit.TestSessionsUnit.test_process_command_session_not_found)
Test command processing when session doesn't exist. ... INFO:httpx:HTTP Request: POST http://test/game/nonexistent-game/command "HTTP/1.1 200 OK"
ok
test_start_game_creates_session_with_character (test_sessions_unit.TestSessionsUnit.test_start_game_creates_session_with_character)
Test that starting a game creates a session with proper character data. ... INFO:httpx:HTTP Request: POST http://test/game/start "HTTP/1.1 200 OK"
ok

----------------------------------------------------------------------
Ran 59 tests in 1.368s

OK

2Ô∏è‚É£  Integration Tests (All integration test files):
time="2026-01-23T14:24:23-05:00" level=warning msg="/Users/harold/code/agentic_ai_rpg_demo/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
onnxruntime cpuid_info warning: Unknown CPU vendor. cpuinfo_vendor value: 0
test_rapid_successive_commands (test_edge_cases_integration.TestConcurrency.test_rapid_successive_commands)
Test sending commands rapidly in succession. ... ok
test_case_insensitive_commands (test_edge_cases_integration.TestEdgeCases.test_case_insensitive_commands)
Test that commands work regardless of case. ... ok
test_empty_command (test_edge_cases_integration.TestEdgeCases.test_empty_command)
Test submitting an empty command. ... ok
test_extra_whitespace_in_commands (test_edge_cases_integration.TestEdgeCases.test_extra_whitespace_in_commands)
Test commands with extra whitespace. ... FAIL
test_invalid_session_id (test_edge_cases_integration.TestEdgeCases.test_invalid_session_id)
Test using an invalid session ID. ... ok
test_mixed_case_item_names (test_edge_cases_integration.TestEdgeCases.test_mixed_case_item_names)
Test picking up items with mixed case. ... FAIL
test_special_characters_in_command (test_edge_cases_integration.TestEdgeCases.test_special_characters_in_command)
Test commands with special characters. ... ok
test_unicode_in_command (test_edge_cases_integration.TestEdgeCases.test_unicode_in_command)
Test commands with unicode characters. ... ok
test_very_long_command (test_edge_cases_integration.TestEdgeCases.test_very_long_command)
Test extremely long command. ... ok
test_whitespace_only_command (test_edge_cases_integration.TestEdgeCases.test_whitespace_only_command)
Test command with only whitespace. ... ok
test_content_length_appropriate (test_examination_integration.TestContentQuality.test_content_length_appropriate)
Verify content is neither too short nor too long. ... ok
test_no_bullet_points_in_descriptions (test_examination_integration.TestContentQuality.test_no_bullet_points_in_descriptions)
Verify no bullet points from atmospheric sections appear. ... ok
test_no_markdown_headers_in_responses (test_examination_integration.TestContentQuality.test_no_markdown_headers_in_responses)
Verify no markdown headers appear in any responses. ... ok
test_no_metadata_in_responses (test_examination_integration.TestContentQuality.test_no_metadata_in_responses)
Verify metadata lines don't appear in responses. ... ok
test_examine_item_in_room (test_examination_integration.TestExamination.test_examine_item_in_room)
Test examining an item focuses on that item, not others. ... ok
test_examine_nonexistent_thing (test_examination_integration.TestExamination.test_examine_nonexistent_thing)
Test examining something that doesn't exist. ... ok
test_examine_room_feature (test_examination_integration.TestExamination.test_examine_room_feature)
Test examining a specific room feature (carved symbols). ... ok
test_examine_thing_in_different_room (test_examination_integration.TestExamination.test_examine_thing_in_different_room)
Test that you can't examine items from other rooms. ... ok
test_look_around (test_examination_integration.TestExamination.test_look_around)
Test general 'look around' command. ... ok
test_bidirectional_movement (test_game_flow_integration.TestMovement.test_bidirectional_movement)
Test moving north then back south. ... ok
test_invalid_direction (test_game_flow_integration.TestMovement.test_invalid_direction)
Test moving in an invalid direction. ... ok
test_valid_movement_north (test_game_flow_integration.TestMovement.test_valid_movement_north)
Test moving north from Cave Entrance to Hidden Alcove. ... ok
test_create_character_and_start_game (test_game_flow_integration.TestSessionManagement.test_create_character_and_start_game)
Test creating a character and starting a new game session. ... /usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestSessionManagement.test_create_character_and_start_game of <test_game_flow_integration.TestSessionManagement testMethod=test_create_character_and_start_game>>)
  return self.run(*args, **kwds)
ok
test_session_persistence (test_game_flow_integration.TestSessionManagement.test_session_persistence)
Test that session state persists across multiple commands. ... FAIL
setUpClass (test_intent_parser_integration.TestIntentParserIntegration) ... ERROR
setUpClass (test_intent_parser_integration.TestIntentParserPerformance) ... ERROR
test_all_aliases (test_item_system_integration.TestItemInteractions.test_all_aliases)
Test that all defined aliases work correctly. ... ok
test_compound_item_names_and (test_item_system_integration.TestItemInteractions.test_compound_item_names_and)
Test that compound commands with 'and' are rejected. ... FAIL
test_compound_item_names_comma (test_item_system_integration.TestItemInteractions.test_compound_item_names_comma)
Test that compound commands with comma are rejected. ... FAIL
test_empty_inventory (test_item_system_integration.TestItemInteractions.test_empty_inventory)
Test checking inventory when empty. ... ok
test_inventory_command (test_item_system_integration.TestItemInteractions.test_inventory_command)
Test checking inventory after picking up items. ... FAIL
test_pickup_duplicate_item (test_item_system_integration.TestItemInteractions.test_pickup_duplicate_item)
Test that picking up same item twice is prevented. ... FAIL
test_pickup_item_from_different_room (test_item_system_integration.TestItemInteractions.test_pickup_item_from_different_room)
Test that you can't pick up items from other rooms. ... ok
test_pickup_nonexistent_item (test_item_system_integration.TestItemInteractions.test_pickup_nonexistent_item)
Test trying to pick up an item that doesn't exist. ... ok
test_pickup_valid_item_full_name (test_item_system_integration.TestItemInteractions.test_pickup_valid_item_full_name)
Test picking up an item using its full name. ... FAIL
test_pickup_with_alias (test_item_system_integration.TestItemInteractions.test_pickup_with_alias)
Test picking up item using an alias (potion -> healing_potion). ... ok
test_pickup_with_normalization (test_item_system_integration.TestItemInteractions.test_pickup_with_normalization)
Test picking up item with spaces (leather pack -> leather_pack). ... FAIL
test_delete_saved_game (test_save_load_integration.TestSaveLoadIntegration.test_delete_saved_game)
Test deleting (soft delete) a saved game. ... ERROR
test_list_saved_games (test_save_load_integration.TestSaveLoadIntegration.test_list_saved_games)
Test listing all saved games. ... ERROR
test_load_nonexistent_save_returns_error (test_save_load_integration.TestSaveLoadIntegration.test_load_nonexistent_save_returns_error)
Test loading a non-existent save returns error. ... ERROR
test_load_saved_game (test_save_load_integration.TestSaveLoadIntegration.test_load_saved_game)
Test loading a saved game from PostgreSQL into Redis. ... ERROR
test_save_game_creates_database_record (test_save_load_integration.TestSaveLoadIntegration.test_save_game_creates_database_record)
Test that saving a game creates a PostgreSQL record. ... ERROR
test_save_game_without_session_name (test_save_load_integration.TestSaveLoadIntegration.test_save_game_without_session_name)
Test saving game with auto-generated session name. ... ERROR
test_save_nonexistent_game_returns_error (test_save_load_integration.TestSaveLoadIntegration.test_save_nonexistent_game_returns_error)
Test saving a non-existent game returns error. ... ERROR
test_save_preserves_game_state (test_save_load_integration.TestSaveLoadIntegration.test_save_preserves_game_state)
Test that saving and loading preserves complete game state. ... ERROR
test_save_tracks_discoveries (test_save_load_integration.TestSaveLoadIntegration.test_save_tracks_discoveries)
Test that saving creates discovery records for visited rooms. ... ERROR
test_update_existing_save (test_save_load_integration.TestSaveLoadIntegration.test_update_existing_save)
Test that saving again updates the existing save. ... ERROR
test_character_creation_and_classes (test_sessions_integration.TestSessionIntegration.test_character_creation_and_classes)
Test character creation and class information endpoints. ... ok
test_error_handling (test_sessions_integration.TestSessionIntegration.test_error_handling)
Test error handling for invalid requests. ... ok
test_full_session_workflow (test_sessions_integration.TestSessionIntegration.test_full_session_workflow)
Test complete session workflow from creation to commands. ... ok
test_health_and_root_endpoints (test_sessions_integration.TestSessionIntegration.test_health_and_root_endpoints)
Test basic health and root endpoints. ... ok
test_inventory_persists_across_rooms (test_state_consistency_integration.TestStateConsistency.test_inventory_persists_across_rooms)
Items in inventory should persist when moving between rooms. ... FAIL
test_item_disappears_from_room_after_pickup (test_state_consistency_integration.TestStateConsistency.test_item_disappears_from_room_after_pickup)
When an item is picked up, it should no longer be in the room. ... FAIL
test_location_updates_correctly (test_state_consistency_integration.TestStateConsistency.test_location_updates_correctly)
Location in game state should update when moving. ... ok
test_multiple_sequential_actions (test_state_consistency_integration.TestStateConsistency.test_multiple_sequential_actions)
Test a sequence of actions maintains consistent state. ... FAIL
test_picked_items_not_examinable_in_original_room (test_state_consistency_integration.TestStateConsistency.test_picked_items_not_examinable_in_original_room)
Items picked up shouldn't be examinable in the room anymore. ... FAIL
test_websocket_chunk_timing (test_websocket_integration.TestWebSocketIntegration.test_websocket_chunk_timing)
Test chunks are delivered with appropriate delays. ... ok
test_websocket_command_streaming (test_websocket_integration.TestWebSocketIntegration.test_websocket_command_streaming)
Test command execution streams response word-by-word. ... ok
test_websocket_complete_message_format (test_websocket_integration.TestWebSocketIntegration.test_websocket_complete_message_format)
Test complete message contains all expected fields. ... ok
test_websocket_connection_established (test_websocket_integration.TestWebSocketIntegration.test_websocket_connection_established)
Test WebSocket connection is established and sends connected message. ... ok
test_websocket_error_handling (test_websocket_integration.TestWebSocketIntegration.test_websocket_error_handling)
Test WebSocket sends error message for invalid commands. ... ok
test_websocket_multiple_commands_sequential (test_websocket_integration.TestWebSocketIntegration.test_websocket_multiple_commands_sequential)
Test multiple commands can be sent sequentially. ... ok
test_websocket_session_state_updates (test_websocket_integration.TestWebSocketIntegration.test_websocket_session_state_updates)
Test session state is updated and returned in complete message. ... ok

======================================================================
ERROR: setUpClass (test_intent_parser_integration.TestIntentParserIntegration)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 204, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 500, in request
    self.endheaders()
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 331, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 219, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/requests/adapters.py", line 644, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 535, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=8001): Max retries exceeded with url: /game/start (Caused by NewConnectionError("HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/tests/test_intent_parser_integration.py", line 29, in setUpClass
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/adapters.py", line 677, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=8001): Max retries exceeded with url: /game/start (Caused by NewConnectionError("HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused"))

======================================================================
ERROR: setUpClass (test_intent_parser_integration.TestIntentParserPerformance)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 204, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 500, in request
    self.endheaders()
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 331, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 219, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/requests/adapters.py", line 644, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 535, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=8001): Max retries exceeded with url: /game/start (Caused by NewConnectionError("HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/tests/test_intent_parser_integration.py", line 200, in setUpClass
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/requests/adapters.py", line 677, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=8001): Max retries exceeded with url: /game/start (Caused by NewConnectionError("HTTPConnection(host='localhost', port=8001): Failed to establish a new connection: [Errno 111] Connection refused"))

======================================================================
ERROR: test_delete_saved_game (test_save_load_integration.TestSaveLoadIntegration.test_delete_saved_game)
Test deleting (soft delete) a saved game.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_list_saved_games (test_save_load_integration.TestSaveLoadIntegration.test_list_saved_games)
Test listing all saved games.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_load_nonexistent_save_returns_error (test_save_load_integration.TestSaveLoadIntegration.test_load_nonexistent_save_returns_error)
Test loading a non-existent save returns error.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_load_saved_game (test_save_load_integration.TestSaveLoadIntegration.test_load_saved_game)
Test loading a saved game from PostgreSQL into Redis.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_save_game_creates_database_record (test_save_load_integration.TestSaveLoadIntegration.test_save_game_creates_database_record)
Test that saving a game creates a PostgreSQL record.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_save_game_without_session_name (test_save_load_integration.TestSaveLoadIntegration.test_save_game_without_session_name)
Test saving game with auto-generated session name.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_save_nonexistent_game_returns_error (test_save_load_integration.TestSaveLoadIntegration.test_save_nonexistent_game_returns_error)
Test saving a non-existent game returns error.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_save_preserves_game_state (test_save_load_integration.TestSaveLoadIntegration.test_save_preserves_game_state)
Test that saving and loading preserves complete game state.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_save_tracks_discoveries (test_save_load_integration.TestSaveLoadIntegration.test_save_tracks_discoveries)
Test that saving creates discovery records for visited rooms.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
ERROR: test_update_existing_save (test_save_load_integration.TestSaveLoadIntegration.test_update_existing_save)
Test that saving again updates the existing save.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 243, in connect
    await self.retry.call_with_retry(
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 650, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 1094, in create_connection
    raise OSError('Multiple exceptions: {}'.format(
OSError: Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 87, in _callSetUp
    self._callAsync(self.asyncSetUp)
  File "/usr/local/lib/python3.11/unittest/async_case.py", line 104, in _callAsync
    return self._asyncioRunner.run(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/tests/test_save_load_integration.py", line 23, in asyncSetUp
    start_game_response = await self.client.post(
                          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 253, in start_game
    session = await create_session(character)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 148, in create_session
    await redis_client.set(f"session:{game_id}", json.dumps(session))
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/client.py", line 601, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1040, in get_connection
    await self.ensure_connection(connection)
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 1062, in ensure_connection
    await connection.connect()
  File "/usr/local/lib/python3.11/site-packages/redis/asyncio/connection.py", line 251, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error connecting to localhost:6379. Multiple exceptions: [Errno 111] Connect call failed ('::1', 6379, 0, 0), [Errno 111] Connect call failed ('127.0.0.1', 6379).

======================================================================
FAIL: test_extra_whitespace_in_commands (test_edge_cases_integration.TestEdgeCases.test_extra_whitespace_in_commands)
Test commands with extra whitespace.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_edge_cases_integration.py", line 125, in test_extra_whitespace_in_commands
    self.assertTrue(data["success"])
AssertionError: False is not true

======================================================================
FAIL: test_mixed_case_item_names (test_edge_cases_integration.TestEdgeCases.test_mixed_case_item_names)
Test picking up items with mixed case.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_edge_cases_integration.py", line 111, in test_mixed_case_item_names
    self.assertTrue(data["success"])
AssertionError: False is not true

======================================================================
FAIL: test_session_persistence (test_game_flow_integration.TestSessionManagement.test_session_persistence)
Test that session state persists across multiple commands.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_game_flow_integration.py", line 71, in test_session_persistence
    self.assertIn("rope", data["session"]["inventory"])
AssertionError: 'rope' not found in ['magical_rope']

======================================================================
FAIL: test_compound_item_names_and (test_item_system_integration.TestItemInteractions.test_compound_item_names_and)
Test that compound commands with 'and' are rejected.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 123, in test_compound_item_names_and
    self.assertFalse(data["success"])
AssertionError: True is not false

======================================================================
FAIL: test_compound_item_names_comma (test_item_system_integration.TestItemInteractions.test_compound_item_names_comma)
Test that compound commands with comma are rejected.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 136, in test_compound_item_names_comma
    self.assertFalse(data["success"])
AssertionError: True is not false

======================================================================
FAIL: test_inventory_command (test_item_system_integration.TestItemInteractions.test_inventory_command)
Test checking inventory after picking up items.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 161, in test_inventory_command
    self.assertIn("rope", data["session"]["inventory"])
AssertionError: 'rope' not found in ['magical_rope']

======================================================================
FAIL: test_pickup_duplicate_item (test_item_system_integration.TestItemInteractions.test_pickup_duplicate_item)
Test that picking up same item twice is prevented.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 110, in test_pickup_duplicate_item
    self.assertFalse(data["success"])
AssertionError: True is not false

======================================================================
FAIL: test_pickup_valid_item_full_name (test_item_system_integration.TestItemInteractions.test_pickup_valid_item_full_name)
Test picking up an item using its full name.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 34, in test_pickup_valid_item_full_name
    self.assertIn("rope", data["session"]["inventory"])
AssertionError: 'rope' not found in ['magical_rope']

======================================================================
FAIL: test_pickup_with_normalization (test_item_system_integration.TestItemInteractions.test_pickup_with_normalization)
Test picking up item with spaces (leather pack -> leather_pack).
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_item_system_integration.py", line 64, in test_pickup_with_normalization
    self.assertTrue(data["success"])
AssertionError: False is not true

======================================================================
FAIL: test_inventory_persists_across_rooms (test_state_consistency_integration.TestStateConsistency.test_inventory_persists_across_rooms)
Items in inventory should persist when moving between rooms.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_state_consistency_integration.py", line 55, in test_inventory_persists_across_rooms
    self.assertTrue(response.json()["success"])
AssertionError: False is not true

======================================================================
FAIL: test_item_disappears_from_room_after_pickup (test_state_consistency_integration.TestStateConsistency.test_item_disappears_from_room_after_pickup)
When an item is picked up, it should no longer be in the room.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_state_consistency_integration.py", line 32, in test_item_disappears_from_room_after_pickup
    self.assertTrue(response.json()["success"])
AssertionError: False is not true

======================================================================
FAIL: test_multiple_sequential_actions (test_state_consistency_integration.TestStateConsistency.test_multiple_sequential_actions)
Test a sequence of actions maintains consistent state.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_state_consistency_integration.py", line 115, in test_multiple_sequential_actions
    self.assertTrue(response.json()["success"])
AssertionError: False is not true

======================================================================
FAIL: test_picked_items_not_examinable_in_original_room (test_state_consistency_integration.TestStateConsistency.test_picked_items_not_examinable_in_original_room)
Items picked up shouldn't be examinable in the room anymore.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/tests/test_state_consistency_integration.py", line 150, in test_picked_items_not_examinable_in_original_room
    self.assertTrue(response.json()["success"])
AssertionError: False is not true

----------------------------------------------------------------------
Ran 61 tests in 167.134s

FAILED (failures=13, errors=12)
exit status 1

üìä Results:
===========
‚úÖ Unit Tests: PASSED
‚ùå Integration Tests: FAILED

üí• Some tests failed!
